# Database Schema — Open Data Platform (Live Snapshot)

Snapshot date: 2025-11-02 (introspected from your Supabase project)

This document lists ALL tables in the public schema with columns, types, nullability, defaults, primary keys, and outbound foreign keys. Values reflect the live database right now.

Notes
- RLS indicates whether Row-Level Security is enabled on the table.
- “Type” shows the actual Postgres type (user-defined enums are listed explicitly).
- “Nullable” is Yes if the column allows NULL.
- “Default” shows the database default expression when present.
- Outbound foreign keys are those declared on this table referencing another table.

---

## Enums (user-defined types)

- availability_type: online, offline, archived
- classification_type: PUBLIC, TERBATAS
- download_channel: WEB, API, DIRECT
- org_type: WALIDATA, PRODUSEN_DATA, KOORDINATOR, LAINNYA
- policy_rule: VIEW, DOWNLOAD, UPDATE, ADMIN
- policy_subject_type: USER, ROLE, ORG
- publication_status: DRAFT, PENDING_REVIEW, PUBLISHED, REJECTED
- qualifier_type: NA, OFFICIAL, PRELIM, EST
- resource_type: TABLE, FILE, API, LINK
- spatial_level: PROV, KAB, KEC, DESA, KEL, OTHER
- time_grain_type: YEAR, QUARTER, MONTH

---

## Tables (full detail)

### public.catalog_metadata
- RLS: Enabled | Rows: 7
- Primary key: id
- Comment: Dataset metadata and catalog information

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| org_id | uuid | Yes |  | Owning org (optional) |
| title | varchar | No |  | |
| slug | varchar | No |  | UNIQUE |
| abstract | text | Yes |  | |
| description | text | Yes |  | |
| last_updated_display | timestamptz | Yes |  | Display freshness date |
| source_name | varchar | Yes |  | |
| publisher_org_id | uuid | Yes |  | Publishing org |
| maintainers | jsonb | Yes | '[]'::jsonb | Array of maintainers |
| contact_email | varchar | Yes |  | |
| classification_code | classification_type | Yes | 'PUBLIC'::classification_type | |
| language | varchar | Yes | 'id'::character varying | |
| license_code | varchar | Yes |  | References lisensi |
| update_frequency_code | varchar | Yes |  | References freq_upd |
| temporal_start | date | Yes |  | |
| temporal_end | date | Yes |  | |
| is_published | boolean | Yes | false | |
| keywords | jsonb | Yes | '[]'::jsonb | |
| custom_fields | jsonb | Yes | '{}'::jsonb | |
| created_by | uuid | Yes |  | References org_users |
| updated_by | uuid | Yes |  | References org_users |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |
| deleted_at | timestamptz | Yes |  | Soft delete |
| publication_status | publication_status | Yes | 'DRAFT'::publication_status | |
| unpublish_request_reason | text | Yes |  | Reason provided by PRODUSEN when requesting to unpublish a dataset |

Outbound foreign keys
- org_id → public.org_organizations.id
- publisher_org_id → public.org_organizations.id
- created_by → public.org_users.id
- updated_by → public.org_users.id
- license_code → public.lisensi.code
- update_frequency_code → public.freq_upd.code

---

### public.catalog_resources
- RLS: Enabled | Rows: 7
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| dataset_id | uuid | No |  | Parent dataset |
| name | varchar | No |  | |
| resource_type | resource_type | No |  | TABLE, FILE, API, LINK |
| schema_json | jsonb | Yes | '{}'::jsonb | |
| description | text | Yes |  | |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |

Outbound foreign keys
- dataset_id → public.catalog_metadata.id

---

### public.catalog_distributions
- RLS: Enabled | Rows: 0
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| resource_id | uuid | No |  | Parent resource |
| version | varchar | No |  | |
| media_type | varchar | No |  | MIME type |
| byte_size | int8 | Yes |  | |
| checksum_sha256 | bpchar | Yes |  | |
| storage_uri | varchar | Yes |  | |
| availability | availability_type | Yes | 'online'::availability_type | online/offline/archived |
| created_at | timestamptz | No | now() | |

Outbound foreign keys
- resource_id → public.catalog_resources.id

---

### public.data_indicators
- RLS: Enabled | Rows: 17
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| resource_id | uuid | No |  | Resource (TABLE) |
| code | varchar | No |  | |
| label | varchar | No |  | |
| unit | varchar | Yes |  | |
| description | text | Yes |  | |
| order_no | int4 | No | 0 | |
| is_active | bool | No | true | |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |

Outbound foreign keys
- resource_id → public.catalog_resources.id

---

### public.data_points
- RLS: Enabled | Rows: 52
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| indicator_id | uuid | No |  | → data_indicators.id |
| resource_id | uuid | No |  | → catalog_resources.id |
| time_grain | time_grain_type | No |  | YEAR/QUARTER/MONTH |
| period_start | date | No |  | |
| period_label | varchar | No |  | |
| value | numeric | Yes |  | |
| qualifier | qualifier_type | No | 'OFFICIAL'::qualifier_type | NA/OFFICIAL/PRELIM/EST |
| distribution_id | uuid | Yes |  | → catalog_distributions.id |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |
| attrs | jsonb | No | '{}'::jsonb | Arbitrary attributes |
| row_dimension_value | text | Yes | COALESCE((attrs ->> 'row_dimension'), '') | generated from attrs |
| top_header_value | text | Yes | COALESCE((attrs ->> 'top_header'), '') | generated from attrs |
| sub_header_value | text | Yes | COALESCE((attrs ->> 'sub_header'), '') | generated from attrs |
| distribution_key | text | Yes | COALESCE((distribution_id)::text, '') | generated helper |

Outbound foreign keys
- indicator_id → public.data_indicators.id
- resource_id → public.catalog_resources.id
- distribution_id → public.catalog_distributions.id

---

### public.data_table_view_columns
- RLS: Enabled | Rows: 18
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| resource_id | uuid | No |  | |
| time_grain | time_grain_type | No |  | YEAR/QUARTER/MONTH |
| period_start | date | No |  | |
| column_label | varchar | No |  | |
| is_hidden | bool | No | false | |
| column_order | int4 | No | 0 | |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |

Outbound foreign keys
- resource_id → public.catalog_resources.id

---

### public.org_organizations
- RLS: Enabled | Rows: 6
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| name | varchar | No |  | |
| short_name | varchar | Yes |  | |
| org_type | org_type | No |  | WALIDATA/PRODUSEN_DATA/KOORDINATOR/LAINNYA |
| parent_id | uuid | Yes |  | Self-reference |
| metadata | jsonb | Yes | '{}'::jsonb | |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |

Outbound foreign keys
- parent_id → public.org_organizations.id

---

### public.org_users
- RLS: Enabled | Rows: 3
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| email | varchar | No |  | UNIQUE |
| full_name | varchar | No |  | |
| org_id | uuid | Yes |  | |
| is_active | bool | Yes | true | |
| attributes | jsonb | Yes | '{}'::jsonb | |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |

Outbound foreign keys
- org_id → public.org_organizations.id

---

### public.org_roles
- RLS: Enabled | Rows: 5
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| code | varchar | No |  | UNIQUE |
| name | varchar | No |  | |
| created_at | timestamptz | No | now() | |

Outbound foreign keys
- (none)

---

### public.org_user_roles
- RLS: Enabled | Rows: 3
- Primary key: (user_id, role_id)

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| user_id | uuid | No |  | |
| role_id | uuid | No |  | |

Outbound foreign keys
- user_id → public.org_users.id
- role_id → public.org_roles.id

---

### public.lisensi
- RLS: Enabled | Rows: 4
- Primary key: code

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| code | varchar | No |  | |
| name | varchar | No |  | |
| url | varchar | Yes |  | |
| notes | text | Yes |  | |

Outbound foreign keys
- (none)

---

### public.freq_upd
- RLS: Enabled | Rows: 6
- Primary key: code

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| code | varchar | No |  | |
| name | varchar | No |  | |
| notes | text | Yes |  | |

Outbound foreign keys
- (none)

---

### public.spatial_units
- RLS: Enabled | Rows: 0
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| name | varchar | No |  | |
| code | varchar | No |  | |
| level | spatial_level | No |  | PROV/KAB/KEC/DESA/KEL/OTHER |
| parent_id | uuid | Yes |  | Self-reference |
| metadata | jsonb | Yes | '{}'::jsonb | |

Outbound foreign keys
- parent_id → public.spatial_units.id

---

### public.catalog_tags
- RLS: Enabled | Rows: 6
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| name | varchar | No |  | UNIQUE |

Outbound foreign keys
- (none)

---

### public.catalog_dataset_tags
- RLS: Enabled | Rows: 0
- Primary key: (dataset_id, tag_id)

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| dataset_id | uuid | No |  | |
| tag_id | uuid | No |  | |

Outbound foreign keys
- dataset_id → public.catalog_metadata.id
- tag_id → public.catalog_tags.id

---

### public.catalog_themes
- RLS: Enabled | Rows: 8
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| code | varchar | No |  | UNIQUE |
| name | varchar | No |  | |
| icon_url | text | Yes |  | URL/path to theme icon |

Outbound foreign keys
- (none)

---

### public.catalog_dataset_themes
- RLS: Enabled | Rows: 3
- Primary key: (dataset_id, theme_id)

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| dataset_id | uuid | No |  | |
| theme_id | uuid | No |  | |

Outbound foreign keys
- dataset_id → public.catalog_metadata.id
- theme_id → public.catalog_themes.id

---

### public.catalog_data_classifications
- RLS: Enabled | Rows: 2
- Primary key: code

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| code | varchar | No |  | |
| name | varchar | No |  | |
| notes | text | Yes |  | |

Outbound foreign keys
- (none)

---

### public.catalog_dataset_spatial_coverage
- RLS: Enabled | Rows: 0
- Primary key: (dataset_id, spatial_id)

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| dataset_id | uuid | No |  | |
| spatial_id | uuid | No |  | |

Outbound foreign keys
- dataset_id → public.catalog_metadata.id
- spatial_id → public.spatial_units.id

---

### public.telemetry_audit_events
- RLS: Enabled | Rows: 0
- Primary key: id (bigint sequence)
- Comment: Audit trail with schema-compliant user references

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | int8 | No | nextval('telemetry_audit_events_id_seq'::regclass) | |
| actor_id | uuid | Yes |  | → auth.users.id |
| action | varchar | No |  | |
| object_type | varchar | Yes |  | |
| object_id | uuid | Yes |  | |
| context | jsonb | Yes | '{}'::jsonb | |
| created_at | timestamptz | No | now() | |

Outbound foreign keys
- actor_id → auth.users.id

---

### public.telemetry_downloads
- RLS: Enabled | Rows: 0
- Primary key: id (bigint sequence)
- Comment: Tracks file downloads with schema-compliant user references

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | int8 | No | nextval('telemetry_downloads_id_seq'::regclass) | |
| distribution_id | uuid | No |  | → catalog_distributions.id |
| user_id | uuid | Yes |  | → auth.users.id |
| channel | download_channel | No |  | WEB/API/DIRECT |
| client_info | jsonb | Yes | '{}'::jsonb | |
| created_at | timestamptz | No | now() | |
| session_id | text | Yes |  | Guest session identifier used to enforce download cooldowns for anonymous users. |

Outbound foreign keys
- distribution_id → public.catalog_distributions.id
- user_id → auth.users.id

---

### public.telemetry_views
- RLS: Enabled | Rows: 25
- Primary key: id (bigint sequence)

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | int8 | No | nextval('telemetry_views_id_seq'::regclass) | |
| dataset_id | uuid | No |  | → catalog_metadata.id |
| user_id | uuid | Yes |  | → auth.users.id |
| session_id | varchar | Yes |  | |
| user_agent | text | Yes |  | |
| ip_address | inet | Yes |  | |
| referrer | text | Yes |  | |
| created_at | timestamptz | No | now() | |

Outbound foreign keys
- dataset_id → public.catalog_metadata.id
- user_id → auth.users.id

---

### public.gov_dataset_policies
- RLS: Enabled | Rows: 0
- Primary key: id

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No | gen_random_uuid() | |
| dataset_id | uuid | No |  | |
| rule | policy_rule | No |  | VIEW/DOWNLOAD/UPDATE/ADMIN |
| subject_type | policy_subject_type | No |  | USER/ROLE/ORG |
| subject_id | uuid | Yes |  | |
| constraint_text | varchar | Yes |  | |
| details | jsonb | Yes | '{}'::jsonb | |
| created_at | timestamptz | No | now() | |

Outbound foreign keys
- dataset_id → public.catalog_metadata.id

---

### public.profiles
- RLS: Enabled | Rows: 4
- Primary key: id (matches auth.users.id)

Columns
| Name | Type | Nullable | Default | Notes |
|------|------|----------|---------|-------|
| id | uuid | No |  | → auth.users.id |
| email | varchar | No |  | |
| full_name | varchar | Yes |  | |
| created_at | timestamptz | No | now() | |
| updated_at | timestamptz | No | now() | |

Outbound foreign keys
- id → auth.users.id

---

## Practical usage tips

- Use upsert on data_points to avoid duplicates: onConflict 'indicator_id,resource_id,period_start'.
- For published datasets, filter publication_status = 'PUBLISHED' and deleted_at IS NULL.
- When inserting, respect enum values exactly as listed.
- Enforce org-based permissions via your RLS policies and role checks.

Example (TypeScript)
```ts
// Fetch published datasets with resource counts
const { data } = await supabase
  .from('catalog_metadata')
  .select('*, publisher_org:org_organizations(name, short_name), resources:catalog_resources(count)')
  .eq('publication_status', 'PUBLISHED')
  .is('deleted_at', null)
  .order('created_at', { ascending: false });
```

---

Document generated from live DB on 2025-11-02. If you want any table expanded further (indexes, example queries, RLS policies), say “expand <table_name>”.

# Database schema (live) — Open Data Platform

Source: Supabase project (live introspection) — snapshot taken: 2025-11-02

This document is a readable summary of the current database schema as inspected directly from your Supabase project. It focuses on the practical parts you will likely need: tables, primary keys, important columns, foreign keys, and user-defined enum values. Read through the tables to understand relationships; examples and tips are provided where helpful.

---

## Quick summary

- RLS: Row-Level Security is enabled on many tables (this system uses role checks and RLS policies).
- Main domains: Catalog (datasets/resources/distributions), Structured data (indicators/periods/points), Organization & users, Telemetry & audit.
- Many reference/enumeration types are implemented as Postgres enums — values are listed in the enums section.

---

## Tables (short reference)

Below are the main tables and a short, readable description of each. For each table I list the primary key, the most important columns, and notable foreign keys.

### catalog_metadata
- Purpose: Dataset registry / central dataset metadata.
- Primary key: id (uuid)
- Notable columns: title, slug (unique), abstract, description, publisher_org_id, license_code, classification_code (enum), publication_status (enum), update_frequency_code, maintainers (jsonb), keywords (jsonb), created_by, updated_by, created_at, updated_at, deleted_at
- Notable foreign keys: publisher_org_id → org_organizations.id, created_by/updated_by → org_users.id (org_users map to auth users in practice), update_frequency_code → freq_upd.code, license_code → lisensi.code
- Comment: stores lifecycle state (DRAFT, PENDING_REVIEW, PUBLISHED) and metadata used by UI/search.

### catalog_resources
- Purpose: Resources attached to a dataset (TABLE, FILE, API, LINK).
- Primary key: id (uuid)
- Notable columns: dataset_id, name, resource_type (enum), schema_json (jsonb), description, created_at, updated_at
- FKs: dataset_id → catalog_metadata.id

### catalog_distributions
- Purpose: File distributions / versions for a resource.
- Primary key: id (uuid)
- Notable columns: resource_id, version, media_type, byte_size, checksum_sha256, storage_uri, availability (enum), created_at
- FKs: resource_id → catalog_resources.id

### data_indicators
- Purpose: Row indicators for structured tables (e.g., metrics like population, GDP).
- Primary key: id (uuid)
- Notable columns: resource_id, code, label, unit, is_active, order_no, created_at, updated_at
- FKs: resource_id → catalog_resources.id

### data_table_view_columns
- Purpose: Column/period definitions for structured resources (time columns: year/month/quarter).
- Primary key: id (uuid)
- Notable columns: resource_id, time_grain (enum), period_start (date), column_label, column_order, is_hidden
- FKs: resource_id → catalog_resources.id

### data_points
- Purpose: The actual values at indicator × period intersections.
- Primary key: id (uuid)
- Notable columns: indicator_id, resource_id, time_grain (enum), period_start, period_label, value (numeric), qualifier (enum), distribution_id, attrs (jsonb), generated helper columns (row_dimension_value, top_header_value, sub_header_value, distribution_key)
- Notable constraints: typically unique on (indicator_id, resource_id, period_start) (the implementation uses upsert patterns for ingestion)
- FKs: indicator_id → data_indicators.id, resource_id → catalog_resources.id, distribution_id → catalog_distributions.id

### org_organizations
- Purpose: Organization registry (hierarchical via parent_id).
- Primary key: id (uuid)
- Notable columns: name, short_name, org_type (enum), parent_id, metadata (jsonb), created_at, updated_at
- FKs: parent_id → org_organizations.id

### org_users
- Purpose: Organization user records (linked to auth users in practice).
- Primary key: id (uuid)
- Notable columns: email (unique), full_name, org_id (nullable), is_active, attributes (jsonb), created_at, updated_at
- FKs: org_id → org_organizations.id

### org_roles / org_user_roles
- `org_roles`: role definitions (id, code, name)
- `org_user_roles`: junction table (user_id, role_id) — primary key is composite (user_id, role_id)
- Purpose: store role assignments separately (prevents privilege escalation when profiles are editable by users)

### lisensi
- Purpose: license lookup table (code primary key)
- Columns: code (PK), name, url, notes

### freq_upd
- Purpose: update frequency lookup (code primary key). Used by `catalog_metadata.update_frequency_code`.

### spatial_units
- Purpose: spatial units / geometry reference table (id, name, code, level enum). Used by dataset spatial coverage.

### catalog_tags, catalog_dataset_tags
- Tags table and dataset ↔ tag junction. Primary keys and composite PK on junction.

### catalog_themes, catalog_dataset_themes
- Themes table and junction for dataset ↔ theme.

### catalog_data_classifications
- Lookup table for classification codes (example: PUBLIC, TERBATAS) — note real values may be implemented as enum or lookup rows.

### catalog_dataset_spatial_coverage
- Junction table between datasets and spatial_units (dataset_id, spatial_id)

### gov_dataset_policies
- Purpose: dataset-level access policies (rule enum, subject_type enum, subject_id, details jsonb)

### profiles
- Purpose: profile records that map to auth.users (id = auth.users.id). Commonly contains email, full_name, timestamps.

### telemetry_views, telemetry_downloads, telemetry_audit_events
- Purpose: analytics and audit trails. Store view/download events and audit events (actor_id → auth.users.id, dataset/resource references). Used for metrics and security/audit.

---

## Foreign keys and relationships (high level)

- catalog_metadata ← catalog_resources ← catalog_distributions (dataset → resource → distribution)
- catalog_metadata ← catalog_dataset_tags → catalog_tags
- catalog_metadata ← catalog_dataset_themes → catalog_themes
- catalog_metadata → catalog_dataset_spatial_coverage → spatial_units
- catalog_resources → data_indicators / data_table_view_columns → data_points
- org_organizations → org_users → org_user_roles → org_roles
- Many tables reference `auth.users` (via `profiles` and direct actor/user columns in telemetry/audit tables). In Supabase, `auth.users` typically stores the identity; profile/org mapping is stored in `profiles` and `org_users`.

---

## Enum types (user-defined Postgres enums)

The following enums are present in your `public` schema (values taken from live introspection):

- availability_type: `online`, `offline`, `archived`
- classification_type: `PUBLIC`, `TERBATAS`
- download_channel: `WEB`, `API`, `DIRECT`
- org_type: `WALIDATA`, `PRODUSEN_DATA`, `KOORDINATOR`, `LAINNYA`
- policy_rule: `VIEW`, `DOWNLOAD`, `UPDATE`, `ADMIN`
- policy_subject_type: `USER`, `ROLE`, `ORG`
- publication_status: `DRAFT`, `PENDING_REVIEW`, `PUBLISHED`, `REJECTED`
- qualifier_type: `NA`, `OFFICIAL`, `PRELIM`, `EST`
- resource_type: `TABLE`, `FILE`, `API`, `LINK`
- spatial_level: `PROV`, `KAB`, `KEC`, `DESA`, `KEL`, `OTHER`
- time_grain_type: `YEAR`, `QUARTER`, `MONTH`

Notes:
- Enums are used for columns like `publication_status`, `classification_type`, `resource_type`, `time_grain_type`, etc.
- Use these exact string values when inserting/updating enum columns from application code.

---

## Practical notes & examples

- Use upsert for `data_points` ingestion to avoid duplicate-key errors. The schema expects uniqueness on indicator/resource/period.
- When creating datasets or resources, always set the `publisher_org_id` and `created_by`/`updated_by` fields correctly so RLS policies let the action succeed.
- For client code (Supabase JS/TS): you can select related rows via foreign key relationships using `select('*, publisher_org:org_organizations(name)')` style projections.

Example: read public published datasets (JS/TS):

```ts
const { data } = await supabase
  .from('catalog_metadata')
  .select('*, publisher_org:org_organizations(name, short_name), resources:catalog_resources(count)')
  .eq('publication_status', 'PUBLISHED')
  .is('deleted_at', null)
  .order('created_at', { ascending: false });
```

Example: upsert a data point

```ts
await supabase.from('data_points').upsert([{
  indicator_id,
  resource_id,
  time_grain: 'YEAR',
  period_start: '2024-01-01',
  value: 12345,
  qualifier: 'OFFICIAL'
}], { onConflict: 'indicator_id,resource_id,period_start' });
```

---

## How this document was produced

- I introspected your Supabase database (live) and generated this human-readable summary. It focuses on the tables and enums currently present in the `public` schema. If you want more detail for a particular table (full column list, column comments, indexes), tell me which table and I will expand that section.

---

If you want, I can now:

1. Expand any table into a detailed column table (name, type, nullable, default, comment). Reply: `expand catalog_metadata`.
2. Produce automated SQL DDL (CREATE TABLE statements) for selected tables.
3. Add examples for RLS policy templates per table.

End of document (generated 2025-11-02)

